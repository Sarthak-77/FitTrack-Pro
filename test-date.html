<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Quick Date Test</title>
</head>

<body>
    <h1>Date Debug Test</h1>
    <div id="output"></div>

    <script type="module">
        import { supabase, getCurrentUser } from './js/supabase.js';

        const output = document.getElementById('output');

        async function test() {
            const user = await getCurrentUser();
            const today = new Date().toISOString().split('T')[0];

            output.innerHTML = `
                <p><strong>User:</strong> ${user?.email}</p>
                <p><strong>Today's Date:</strong> ${today}</p>
                <p><strong>JavaScript Date:</strong> ${new Date().toString()}</p>
                <hr>
                <h3>Checking database for today (${today}):</h3>
            `;

            // Check what's in the database for today
            const { data: todayData, error: todayError } = await supabase
                .from('daily_stats')
                .select('*')
                .eq('user_id', user.id)
                .eq('date', today)
                .maybeSingle();

            if (todayError) {
                output.innerHTML += `<p style="color:red">Error: ${todayError.message}</p>`;
            } else if (!todayData) {
                output.innerHTML += `<p style="color:orange">⚠️ No record found for today (${today})</p>`;
                output.innerHTML += `<p>Creating record...</p>`;

                const { data: newData, error: insertError } = await supabase
                    .from('daily_stats')
                    .insert({
                        user_id: user.id,
                        date: today,
                        steps: 0,
                        calories_burned: 0,
                        water_intake: 0
                    })
                    .select()
                    .single();

                if (insertError) {
                    output.innerHTML += `<p style="color:red">Insert Error: ${insertError.message}</p>`;
                } else {
                    output.innerHTML += `<p style="color:green">✅ Created: ${JSON.stringify(newData, null, 2)}</p>`;
                }
            } else {
                output.innerHTML += `<p style="color:green">✅ Found record for today:</p>`;
                output.innerHTML += `<pre>${JSON.stringify(todayData, null, 2)}</pre>`;
            }

            // Also check yesterday
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            const yesterdayStr = yesterday.toISOString().split('T')[0];

            output.innerHTML += `<hr><h3>Checking database for yesterday (${yesterdayStr}):</h3>`;

            const { data: yesterdayData } = await supabase
                .from('daily_stats')
                .select('*')
                .eq('user_id', user.id)
                .eq('date', yesterdayStr)
                .maybeSingle();

            if (yesterdayData) {
                output.innerHTML += `<p style="color:blue">Found record for yesterday:</p>`;
                output.innerHTML += `<pre>${JSON.stringify(yesterdayData, null, 2)}</pre>`;
            } else {
                output.innerHTML += `<p>No record for yesterday</p>`;
            }
        }

        test();
    </script>
    <script type="module" src="js/supabase.js"></script>
</body>

</html>