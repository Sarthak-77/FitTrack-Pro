<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FitTrack Pro - Meal Planner</title>
    <link rel="stylesheet" href="css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>

<body>
    <nav class="navbar">
        <a href="app.html" class="brand">FitTrack Pro</a>
        <div class="nav-links">
            <a href="app.html" class="nav-link">Dashboard</a>
            <a href="activity.html" class="nav-link">Activity Log</a>
            <a href="meals.html" class="nav-link active">Meals</a>
            <a href="insights.html" class="nav-link">Insights</a>
        </div>
        <div class="nav-right">
            <div id="live-clock" class="text-muted font-mono">00:00:00</div>
            <a href="profile.html" class="profile-avatar-link" title="Profile">
                <div class="profile-avatar-nav" id="nav-profile-avatar">
                    <span id="nav-avatar-initials">U</span>
                </div>
            </a>
            <a href="#" class="nav-link nav-logout" onclick="logout()" style="color: var(--danger-color);">Logout</a>
        </div>
    </nav>

    <main class="container animate-fade-in">
        <header class="mb-2 flex justify-between items-center">
            <h1>Meal Planner</h1>
            <div class="card py-2 px-4">
                <span class="text-muted">Total Calories:</span>
                <span id="total-calories" class="text-xl font-bold text-success ml-2">0</span>
            </div>
        </header>

        <div class="grid grid-3 mt-4">
            <!-- Breakfast -->
            <div class="card">
                <div class="flex justify-between items-center mb-2">
                    <h2 class="text-warning">Breakfast</h2>
                    <button class="btn btn-secondary text-sm add-meal-btn" data-type="breakfast">+ Add</button>
                </div>
                <div id="breakfast-list" class="min-h-[100px]">
                    <!-- Populated by JS -->
                </div>
            </div>

            <!-- Lunch -->
            <div class="card">
                <div class="flex justify-between items-center mb-2">
                    <h2 class="text-success">Lunch</h2>
                    <button class="btn btn-secondary text-sm add-meal-btn" data-type="lunch">+ Add</button>
                </div>
                <div id="lunch-list" class="min-h-[100px]">
                    <!-- Populated by JS -->
                </div>
            </div>

            <!-- Dinner -->
            <div class="card">
                <div class="flex justify-between items-center mb-2">
                    <h2 class="text-primary">Dinner</h2>
                    <button class="btn btn-secondary text-sm add-meal-btn" data-type="dinner">+ Add</button>
                </div>
                <div id="dinner-list" class="min-h-[100px]">
                    <!-- Populated by JS -->
                </div>
            </div>
        </div>
    </main>

    <!-- Bottom Navigation (Mobile Only) -->
    <nav class="bottom-nav">
        <a href="app.html" class="bottom-nav-item">
            <svg viewBox="0 0 24 24">
                <path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z" />
            </svg>
            <span>Home</span>
        </a>
        <a href="activity.html" class="bottom-nav-item">
            <svg viewBox="0 0 24 24">
                <path
                    d="M20.38 8.57l-1.23 1.85a8 8 0 0 1-.22 7.58H5.07A8 8 0 0 1 8.8 5.28l.73 1.34 2-3-6.63-1A10 10 0 0 0 1.05 13H0a12 12 0 0 1 22.77-5.53l-2.39 1.1zM7 12a5 5 0 1 1 5 5 5 5 0 0 1-5-5z" />
            </svg>
            <span>Activity</span>
        </a>
        <a href="meals.html" class="bottom-nav-item active">
            <svg viewBox="0 0 24 24">
                <path
                    d="M11 9H9V2H7v7H5V2H3v7c0 2.12 1.66 3.84 3.75 3.97V22h2.5v-9.03C11.34 12.84 13 11.12 13 9V2h-2v7zm5-3v8h2.5v8H21V2c-2.76 0-5 2.24-5 4z" />
            </svg>
            <span>Meals</span>
        </a>
        <a href="insights.html" class="bottom-nav-item">
            <svg viewBox="0 0 24 24">
                <path d="M3.5 18.49l6-6.01 4 4L22 6.92l-1.41-1.41-7.09 7.97-4-4L2 16.99z" />
            </svg>
            <span>Insights</span>
        </a>
        <a href="profile.html" class="bottom-nav-item">
            <svg viewBox="0 0 24 24">
                <path
                    d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
            </svg>
            <span>Profile</span>
        </a>
    </nav>

    <!-- Meal Entry Modal -->
    <div id="meal-modal" class="modal-overlay">
        <div class="modal" style="max-width: 500px;">
            <h3 class="mb-2">Add Meal</h3>
            <form id="meal-form" class="grid gap-2 text-left">
                <div>
                    <label class="text-sm text-muted">Meal Name</label>
                    <input type="text" id="meal-name" class="w-full p-2 rounded"
                        style="background: rgba(0,0,0,0.2); border: 1px solid rgba(255,255,255,0.1); color: white; width: 100%;"
                        required placeholder="e.g. Grilled Chicken">
                </div>
                <div>
                    <label class="text-sm text-muted">Calories</label>
                    <input type="number" id="meal-calories" class="w-full p-2 rounded"
                        style="background: rgba(0,0,0,0.2); border: 1px solid rgba(255,255,255,0.1); color: white; width: 100%;"
                        required min="1" placeholder="e.g. 350">
                </div>
                <div class="flex gap-2 mt-2">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">Add Meal</button>
                    <button type="button" class="btn btn-secondary" onclick="closeMealModal()"
                        style="flex: 1;">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <script type="module" src="js/supabase.js"></script>
    <script type="module" src="js/data.js"></script>
    <script type="module" src="js/app.js"></script>
    <script type="module" src="js/auth.js"></script>
    <script type="module">
        import { getCurrentUser } from './js/supabase.js';
        async function loadNavAvatar() {
            const user = await getCurrentUser();
            if (user) {
                const initials = (user.user_metadata?.name || user.email).split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
                const avatarEl = document.getElementById('nav-avatar-initials');
                if (avatarEl) avatarEl.textContent = initials;
            }
        }
        loadNavAvatar();
    </script>
    <script>
        let currentMealType = '';

        function openMealModal(type) {
            currentMealType = type;
            document.getElementById('meal-modal').classList.add('active');
            document.getElementById('meal-name').focus();
        }

        function closeMealModal() {
            document.getElementById('meal-modal').classList.remove('active');
            document.getElementById('meal-form').reset();
        }

        document.getElementById('meal-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('meal-name').value;
            const calories = parseInt(document.getElementById('meal-calories').value);

            if (name && calories) {
                await dataManager.addMeal(currentMealType, { name, calories });
                await renderMeals();
                await updateTotalCalories();
                closeMealModal();
            }
        });

        // Update the add meal buttons to use the modal
        document.querySelectorAll('.add-meal-btn').forEach(btn => {
            btn.onclick = (e) => {
                openMealModal(e.target.dataset.type);
            };
        });
    </script>
</body>

</html>