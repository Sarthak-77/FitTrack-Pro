<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FitTrack Pro - Insights</title>
    <link rel="stylesheet" href="css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>

<body>
    <nav class="navbar">
        <a href="app.html" class="brand">FitTrack Pro</a>
        <div class="nav-links">
            <a href="app.html" class="nav-link">Dashboard</a>
            <a href="activity.html" class="nav-link">Activity Log</a>
            <a href="meals.html" class="nav-link">Meals</a>
            <a href="insights.html" class="nav-link active">Insights</a>
        </div>
        <div class="nav-right">
            <div id="live-clock" class="text-muted font-mono">00:00:00</div>
            <a href="profile.html" class="profile-avatar-link" title="Profile">
                <div class="profile-avatar-nav" id="nav-profile-avatar">
                    <span id="nav-avatar-initials">U</span>
                </div>
            </a>
            <a href="#" class="nav-link nav-logout" onclick="logout()" style="color: var(--danger-color);">Logout</a>
        </div>
    </nav>

    <main class="container animate-fade-in">
        <header class="mb-2 flex justify-between items-center">
            <h1>Weekly Insights</h1>
            <div class="flex gap-2">
                <button id="download-btn" class="btn btn-primary">Download Summary</button>
                <button id="reset-btn" class="btn btn-secondary text-danger">Reset Dashboard</button>
            </div>
        </header>

        <div class="grid grid-2 mt-4">
            <!-- Steps Chart -->
            <div class="card">
                <h3 class="mb-4">Steps History (Last 7 Days)</h3>
                <div id="steps-chart"></div>
                <div id="steps-labels" class="flex justify-between text-xs text-muted mt-2">
                    <span>Mon</span><span>Tue</span><span>Wed</span><span>Thu</span><span>Fri</span><span>Sat</span><span>Sun</span>
                </div>
            </div>

            <!-- Calories Chart -->
            <div class="card">
                <h3 class="mb-4">Calories Burned (Last 7 Days)</h3>
                <div id="calories-chart"></div>
                <div id="calories-labels" class="flex justify-between text-xs text-muted mt-2">
                    <span>Mon</span><span>Tue</span><span>Wed</span><span>Thu</span><span>Fri</span><span>Sat</span><span>Sun</span>
                </div>
            </div>
        </div>
    </main>

    <!-- Bottom Navigation (Mobile Only) -->
    <nav class="bottom-nav">
        <a href="app.html" class="bottom-nav-item">
            <svg viewBox="0 0 24 24">
                <path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z" />
            </svg>
            <span>Home</span>
        </a>
        <a href="activity.html" class="bottom-nav-item">
            <svg viewBox="0 0 24 24">
                <path
                    d="M20.38 8.57l-1.23 1.85a8 8 0 0 1-.22 7.58H5.07A8 8 0 0 1 8.8 5.28l.73 1.34 2-3-6.63-1A10 10 0 0 0 1.05 13H0a12 12 0 0 1 22.77-5.53l-2.39 1.1zM7 12a5 5 0 1 1 5 5 5 5 0 0 1-5-5z" />
            </svg>
            <span>Activity</span>
        </a>
        <a href="meals.html" class="bottom-nav-item">
            <svg viewBox="0 0 24 24">
                <path
                    d="M11 9H9V2H7v7H5V2H3v7c0 2.12 1.66 3.84 3.75 3.97V22h2.5v-9.03C11.34 12.84 13 11.12 13 9V2h-2v7zm5-3v8h2.5v8H21V2c-2.76 0-5 2.24-5 4z" />
            </svg>
            <span>Meals</span>
        </a>
        <a href="insights.html" class="bottom-nav-item active">
            <svg viewBox="0 0 24 24">
                <path d="M3.5 18.49l6-6.01 4 4L22 6.92l-1.41-1.41-7.09 7.97-4-4L2 16.99z" />
            </svg>
            <span>Insights</span>
        </a>
        <a href="profile.html" class="bottom-nav-item">
            <svg viewBox="0 0 24 24">
                <path
                    d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
            </svg>
            <span>Profile</span>
        </a>
    </nav>

    <!-- Confirmation Modal -->
    <div id="confirm-modal" class="modal-overlay">
        <div class="modal-content glass-effect">
            <div class="modal-header">
                <h3 id="confirm-title">Confirm Action</h3>
                <button class="modal-close" onclick="closeConfirmModal()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <p id="confirm-message" class="text-muted">Are you sure you want to proceed?</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeConfirmModal()">Cancel</button>
                <button class="btn btn-danger" id="confirm-btn">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="success-modal" class="modal-overlay">
        <div class="modal-content glass-effect" style="text-align: center;">
            <div class="modal-body" style="margin: 0; padding: 2rem 0;">
                <div style="font-size: 3rem; margin-bottom: 1rem;">ðŸŽ‰</div>
                <h3 id="success-title" class="mb-2"
                    style="background: var(--gradient-main); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; font-size: 1.5rem;">
                    Success!</h3>
                <p id="success-message" class="text-muted">Action completed successfully.</p>
            </div>
            <button class="btn btn-primary" onclick="closeSuccessModal()" style="width: 100%;">Awesome!</button>
        </div>
    </div>

    <script type="module" src="js/supabase.js"></script>
    <script type="module" src="js/data.js"></script>
    <script type="module" src="js/app.js"></script>
    <script type="module" src="js/auth.js"></script>
    <script type="module">
        import { getCurrentUser } from './js/supabase.js';
        async function loadNavAvatar() {
            const user = await getCurrentUser();
            if (user) {
                const initials = (user.user_metadata?.name || user.email).split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
                const avatarEl = document.getElementById('nav-avatar-initials');
                if (avatarEl) avatarEl.textContent = initials;
            }
        }
        loadNavAvatar();

        // Modal Logic
        window.closeConfirmModal = () => document.getElementById('confirm-modal').classList.remove('active');
        window.closeSuccessModal = () => document.getElementById('success-modal').classList.remove('active');
    </script>
</body>

</html>